"use strict";(globalThis.webpackChunk_github_ui_github_ui=globalThis.webpackChunk_github_ui_github_ui||[]).push([["56943"],{44050(e,t,o){o.r(t),o.d(t,{default:()=>A});var a=o(74848),i=o(22625),r=o(70516),n=o(37198),s=o(89079),c=o(1703),l=o(68695),m=o(55700),d=o(96540),u=o(1695),g=o(22437),p=o(32087),h=o(97286),f=o(54695),_=o(32343);o(77290);var w=o(90254);async function y(e){let t=[];for await(let o of e.stream())t.push(o);if(0===t.length)throw Error("No messages found in stream");if(t.length>1)throw Error("More than one message found in stream");return t[0]}function E(e,t,o,a){return[{patch:(0,w.YB)(o,a,e,t),path:a}].map(e=>({type:"github.diff-hunk",data:{type:"diff-hunk",changeReference:"",fileName:e.path,headerContext:"",diff:(0,w.Gu)(e.patch)}}))}function S(e,t,o=2,a=!1){if(a||(e=e.toLowerCase(),t=t.toLowerCase()),e.length<o||t.length<o)return 0;let i=new Map;for(let t=0;t<e.length-(o-1);t++){let a=e.slice(t,t+o);i.set(a,i.has(a)?i.get(a)+1:1)}let r=0;for(let e=0;e<t.length-(o-1);e++){let a=t.slice(e,e+o),n=i.has(a)?i.get(a):0;n>0&&(i.set(a,n-1),r++)}return 2*r/(e.length+t.length-(o-1)*2)}function b(e){return{commitMessage:e,description:""}}let C=[402,429];function M(e,t){let o=performance.now()-t;(0,f.iv)({incrementKey:e,requestUrl:window.location.href}),(0,f.iv)({distributionKey:"GENERATED_COMMIT_MESSAGE_LATENCY",distributionValue:Math.round(o),requestUrl:window.location.href})}var v=o(75701),k=o(37491);async function T(e){let t=await (0,l.lS)(e);return t.ok?(await t.json()).data.hasQuorum:{statusText:t.statusText}}async function N(e){let t=!1,o=0;try{for(;!1===t&&o<3;){let a=await T(`${e}?attempt_number=${o+1}`);if("boolean"==typeof a)(t=t||a)||(o++,await (0,k.uk)(1e3*o));else break}}catch{}}function A(e){let{content:t,contentChanged:o,fileName:f,isDelete:w,isNewFile:k,oldPath:T,ownerName:A,placeholderMessage:R,refName:O,generateCommitMessageInfo:I,webCommitInfo:G,setDialogState:D,setSecretDetected:P,setSecretBypassMetadata:q}=e,{authorEmails:F,canCommitStatus:j,commitOid:x,defaultEmail:U,defaultNewBranchName:$,forkedRepo:B,guidanceTask:J,pr:L,repoHeadEmpty:W,saveUrl:K}=G,Q=(0,c.Z)(),V=function(){let{sendClickAnalyticsEvent:e}=(0,_.S)();return(0,d.useCallback)(async({message:t,description:o,placeholderMessage:a,generatedCommitMessage:i,showingGeneratedCommitMessage:r,showingGeneratedCommitDescription:n,isNewFile:s,isDelete:c,contentChanged:l,oldPath:m,fileName:d,content:u,regenerateCallCount:g,version:p})=>{let h={category:"web_commit_dialog",action:"submit",showing_generated_commit_message:r,showing_generated_commit_description:n,full_message_acceptence:t===a||t===i?.commitMessage,message_similarity:S(t,i?.commitMessage??""),full_description_acceptence:o===i?.description,description_similarity:S(o,i?.description??""),message_description_similarity:S(i?.commitMessage??"",i?.description??""),file_status:c?"D":s?"A":d!==m?l?"M":"R":"M",empty_description:""===o.trim(),change_chars_count:u?.replace(/\s+/g,"").length,regenerate_call_count:g??0,version:p};e(h)},[e])}(),X=function(){let{sendClickAnalyticsEvent:e}=(0,_.S)();return(0,d.useCallback)(async({version:t,regenerateCallCount:o,uniquelyGeneratedMessagesCount:a})=>{e({category:"web_commit_dialog",action:"regenerate",version:t,regenerate_call_count:o,uniquely_generated_messages_count:a})},[e])}(),Y=(0,r.t)(),[z,Z]=d.useState([]),[H,ee]=d.useState(0),{generatedCommitMessage:et,isFetching:eo}=function(e,t,o,a,i,r,n,s,c){let l=void 0===t||!t.copilotAccessAllowed||void 0===i||void 0===r||void 0===o||void 0===a||!i&&!r,{sendClickAnalyticsEvent:m}=(0,_.S)(),{data:d,isFetching:f}=(0,h.I)({queryKey:["generate-commit-message",r,a,c],queryFn:async()=>{let c=performance.now(),l=new u.JR(t.ssoOrganizations.map(e=>e.id)),d=await l.getAuthToken(),h=n&&i===r?E("",r,o,a):E(i,r,o,a),f="";s&&s.length>0&&(f+=function(e){let t="## Additional context from previous messages\n\nDo not repeat or closely paraphrase any of these previously used messages. Instead, generate a new commit message that has a different focus, wording, or level of detail. If you cannot think of a new message, change the perspective, focus on different details, or rephrase creatively.\n\n\x3c!-- BEGIN PREVIOUS MESSAGES --\x3e\n";for(let o of e)t+=`### Previous message

${o}

`;return t+"\x3c!-- END PREVIOUS MESSAGES --\x3e\n\n"}(s));let _=await (0,g.p)({authToken:d,basePath:t.apiUrl,body:{messages:[{role:"user",content:f,copilot_references:h}],temperature:.3,response_format:{type:"json_schema",json_schema:{description:"The schema to abide by when generating commit message output",name:"commit_message_response",strict:!0,schema:{type:"object",properties:{title:{type:"string",description:"The commit message title/summary"},description:{type:"string",description:"The commit message description/body"}},required:["title","description"],additionalProperties:!1}}}},integrationId:"commit-msg-gen",method:"POST",path:"/agents/github-commit-message-generation",streamingResponse:!0});try{if(!_.ok)throw Error("Failed to generate commit message");let t=_.body?.getReader();if(!t)throw Error("No reader found in response body");let o=new p.X(t),a=await y(o),i=function(e){let t,o=e?.choices?.[0]?.message;if(!o)throw Error("No message found in agent response");if(!o.content)throw Error("No content found in commit message");try{t=JSON.parse(o.content)}catch{throw Error("Invalid JSON in commit message response")}if(void 0===t.title||null===t.title)throw Error("No title field found in commit message response");if(void 0===t.description||null===t.description)throw Error("No description field found in commit message response");if(""!==t.title.trim())return{commitMessage:t.title,description:t.description}}(a);M("GENERATED_COMMIT_MESSAGE_SUCCESS",c);let r=function(e){if(!e||0===e.length||!e[0]?.data)throw Error("Copilot references are empty or undefined");let t=0,{changeReference:o,diff:a,fileName:i,headerContext:r}=e[0]?.data;return Math.ceil((t+=o.length+a.length+i.length+r.length)/4)}(h),n=function(e){if(!e||!e.choices[0]?.message.content)throw Error("Commit message is empty or undefined");return Math.ceil(e.choices[0].message.content.length/4)}(a);if(m({category:"copilot_generate_commit_message",action:"generate",input_token_count:r,output_token_count:n,total_token_count:r+n}),i)return i;return b(e)}catch{return C.includes(_.status)||M("GENERATED_COMMIT_MESSAGE_ERROR",c),b(e)}},enabled:!l,meta:{action:"get-generated-commit-message"}});return l?{generatedCommitMessage:b(e),isFetching:!1}:{generatedCommitMessage:d,isFetching:f}}(R,I?.copilotGenerateCommitMessageAuthInfo,I?.initialPath,I?.completeFilePath,I?.initialFileContent,I?.currentFileContent,k,z,H),ea=I?.copilotGenerateCommitMessageAuthInfo?.copilotAccessAllowed,ei=ea&&eo,[er,en]=d.useState(ei?"":R),[es,ec]=d.useState(""),[el,em]=d.useState(!1),[ed,eu]=d.useState(!1),[eg,ep]=d.useState(!1),[eh,ef]=d.useState(!1);(0,d.useEffect)(()=>{if(et?.commitMessage&&!eo&&!eg){en(et.commitMessage),em(et.commitMessage!==R),eh||ef(et.commitMessage!==R);let e=z;z.includes(et.commitMessage)||Z(e=[...z,et.commitMessage]),H>0&&X({version:"1",regenerateCallCount:H,uniquelyGeneratedMessagesCount:e.length}),et?.description!==void 0&&(ec(et.description),et?.description&&eu(!0))}},[et?.commitMessage,et?.description,eo,R,eg,eh,z,H,X]);let[e_,ew]=d.useState("allowed"!==j||!!B),[ey,eE]=d.useState($),[eS,eb]=d.useState(F.length?U:void 0),[eC,eM]=d.useState(""),[ev,ek]=d.useState(),{refreshTree:eT}=(0,n.Uy)(),eN=(0,i.yY)(),eA=d.useRef(null);(0,d.useEffect)(()=>{eA.current&&eA.current.focus()},[]);let eR=!B&&!W;(0,d.useEffect)(()=>{("closed"===e.dialogState||"saved"===e.dialogState)&&Z([])},[e.dialogState]);let eO=d.useCallback(()=>{eg||ep(!0)},[eg]),eI=d.useCallback(()=>{eg||eo||(en(""),em(!1),ec(""),eu(!1),ee(e=>e+1))},[eg,eo]),eG=ei&&!eg,eD=ea&&(el||ed)&&!eo,eP=async()=>{let e;D("saving");let a=B?`${A}:${O}`:O,i={message:er,placeholder_message:R,description:es,author_email:eS??void 0,"commit-choice":eR?e_?"quick-pull":"direct":void 0,target_branch:eR?e_?ey:O:void 0,quick_pull:e_?a:"",guidance_task:J??"",commit:x,same_repo:B||W?void 0:1,pr:L??""};e=w?{...i,_method:"delete"}:{...i,content_changed:o,filename:k?f:T,new_filename:f,value:t};let r=new FormData;for(let[t,o]of Object.entries(e))void 0!==o&&r.set(t,o);try{let a=await (0,l.DI)(K,{method:"post",body:r,headers:{Accept:"application/json"}}),i=await a.json();if(i.data.commitQuorumPollPath&&await N(i.data.commitQuorumPollPath),i.data.redirect){V({message:e.message,description:e.description,placeholderMessage:R,generatedCommitMessage:et,showingGeneratedCommitMessage:el,showingGeneratedCommitDescription:ed,isNewFile:k,isDelete:w,contentChanged:o,oldPath:T,fileName:f,content:t,regenerateCallCount:H,version:"1"});let a=i.data.redirect,r=a.startsWith(window.location.origin)?a.replace(window.location.origin,""):a;if((0,s.q)(),eT?.current!==void 0&&(eT.current=!0),f)try{await (0,v.eX)({owner:Y.ownerLogin,repo:Y.name,path:f})}catch{}i.data.message&&eN({message:i.data.message,variant:"default"}),D("saved"),setTimeout(()=>{Q(r)},50);return}i.data.error&&i.data.secretBypassMetadata?(P?.(!0),q?.(i.data.secretBypassMetadata),D("closed")):i.data.error?(D("pending"),eM(i.data.error),i.data.error_details&&ek(i.data.error_details)):(eM("File could not be edited"),D("pending"))}catch{eM("File could not be edited"),D("pending")}};return(0,a.jsx)(m.WebCommitDialog,{onSave:eP,message:er,setMessage:en,description:es,setDescription:ec,isQuickPull:e_,setIsQuickPull:ew,prTargetBranch:ey,setPRTargetBranch:eE,setAuthorEmail:eb,errorMessage:eC,errorDetails:ev,isFetching:eo,showGeneratingCommitMessageLoading:eG,showGeneratingCommitMessageLoaded:eD,hasShownGeneratedCommitMessage:eh,onCopilotCommitGenerationCancel:eO,onRegenerateCommitMessageClick:eI,...e})}A.displayName="WebCommitDialog"},32087(e,t,o){o.d(t,{X:()=>CopilotChatMessageStreamer});var a=o(50467);let i=/^data:\s+/;let CopilotStreamingError=class CopilotStreamingError extends Error{constructor(e){super(e.description),(0,a._)(this,"error",void 0),this.error=e,this.name="CopilotStreamingError"}};let CopilotChatMessageStreamer=class CopilotChatMessageStreamer{async *stream(){let e=new TextDecoder("utf-8"),t="";for(;;){let o,a;try{({value:o,done:a}=await this.reader.read())}catch{throw new CopilotStreamingError({type:"error",errorType:"networkError",description:"NETWORK_CONNECTION_INTERRUPTED"})}if(a)break;for(t+=e.decode(o);;){let e=t.indexOf("\n\n");if(-1===e)break;let o=t.slice(0,e).replace(i,"");if("[DONE]"===o)return;let a=JSON.parse(o);if(yield a,a?.type==="complete")return;t=t.slice(e+2)}}}async stop(){return this.reader.cancel()}constructor(e){(0,a._)(this,"reader",void 0),this.reader=e}}}}]);
//# sourceMappingURL=chunk-56943-d091eb2bbab41f3f-9434d0c14b6f3f3a.js.map